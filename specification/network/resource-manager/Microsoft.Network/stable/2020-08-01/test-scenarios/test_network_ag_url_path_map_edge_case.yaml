scope: ResourceGroup
testScenarios:
  - description: test_network_ag_url_path_map_edge_case
    steps:
      - step: Create_publicIPAddresses_pip1
        resourceName: publicIPAddresses_pip1
        exampleFile: ../examples/Create_publicIPAddresses_pip1_Generated_230.json
        operationId: PublicIPAddresses_CreateOrUpdate
      - step: ApplicationGateways_Get_231
        exampleFile: ../examples/ApplicationGateways_Get_231_Generated.json
        operationId: ApplicationGateways_Get
      - step: Create_applicationGateways_ag1
        resourceName: applicationGateways_ag1
        exampleFile: ../examples/Create_applicationGateways_ag1_Generated_233.json
        operationId: ApplicationGateways_CreateOrUpdate
      - step: Update_applicationGateways_ag1_235
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/provisioningState
            value: Succeeded
          - replace: /properties/operationalState
            value: Running
          - replace: /properties/gatewayIPConfigurations/0/properties/provisioningState
            value: Succeeded
          - replace: >-
              /properties/frontendIPConfigurations/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/frontendPorts/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/backendAddressPools/0/properties/provisioningState
            value: Succeeded
          - replace: >-
              /properties/backendHttpSettingsCollection/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/httpListeners/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/httpListeners/1/properties/provisioningState
            value: Succeeded
          - replace: /properties/requestRoutingRules/0/properties/provisioningState
            value: Succeeded
          - add: /properties/rewriteRuleSets/0
            value:
              name: myruleset
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/rewriteRuleSets/myruleset
              properties:
                provisioningState: Succeeded
                rewriteRules: []
              type: Microsoft.Network/applicationGateways/rewriteRuleSets
      - step: Update_applicationGateways_ag1_237
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - add: /properties/httpListeners/1/properties/redirectConfiguration
            value:
              - id: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/redirectConfigurations/myconfig
          - add: /properties/redirectConfigurations/0
            value:
              name: myconfig
              properties:
                redirectType: Permanent
                targetListener:
                  id: >-
                    /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/httpListeners/mylistener
                provisioningState: Succeeded
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/redirectConfigurations/myconfig
              type: Microsoft.Network/applicationGateways/redirectConfigurations
      - step: Update_applicationGateways_ag1_239
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/provisioningState
            value: Updating
          - replace: /properties/gatewayIPConfigurations/0/properties/provisioningState
            value: Updating
          - replace: >-
              /properties/frontendIPConfigurations/0/properties/provisioningState
            value: Updating
          - replace: /properties/frontendPorts/0/properties/provisioningState
            value: Updating
          - replace: /properties/backendAddressPools/0/properties/provisioningState
            value: Updating
          - add: /properties/backendAddressPools/1
            value:
              name: mypool
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/backendAddressPools/mypool
              properties:
                provisioningState: Updating
                backendAddresses: []
              type: Microsoft.Network/applicationGateways/backendAddressPools
          - replace: >-
              /properties/backendHttpSettingsCollection/0/properties/provisioningState
            value: Updating
          - replace: /properties/httpListeners/0/properties/provisioningState
            value: Updating
          - replace: /properties/httpListeners/1/properties/provisioningState
            value: Updating
          - replace: /properties/requestRoutingRules/0/properties/provisioningState
            value: Updating
          - replace: /properties/rewriteRuleSets/0/properties/provisioningState
            value: Updating
          - replace: /properties/redirectConfigurations/0/properties/provisioningState
            value: Updating
      - step: Update_applicationGateways_ag1_241
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/provisioningState
            value: Succeeded
          - replace: /properties/gatewayIPConfigurations/0/properties/provisioningState
            value: Succeeded
          - replace: >-
              /properties/frontendIPConfigurations/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/frontendPorts/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/backendAddressPools/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/backendAddressPools/1/properties/provisioningState
            value: Succeeded
          - replace: >-
              /properties/backendHttpSettingsCollection/0/properties/provisioningState
            value: Succeeded
          - add: /properties/backendHttpSettingsCollection/1
            value:
              name: http_settings
              properties:
                port: 443
                protocol: Https
                cookieBasedAffinity: Disabled
                authenticationCertificates: []
                trustedRootCertificates: []
                connectionDraining:
                  enabled: false
                  drainTimeoutInSec: 1
                provisioningState: Succeeded
                pickHostNameFromBackendAddress: false
                requestTimeout: 30
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/backendHttpSettingsCollection/http_settings
              type: >-
                Microsoft.Network/applicationGateways/backendHttpSettingsCollection
          - replace: /properties/httpListeners/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/httpListeners/1/properties/provisioningState
            value: Succeeded
          - replace: /properties/requestRoutingRules/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/rewriteRuleSets/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/redirectConfigurations/0/properties/provisioningState
            value: Succeeded
      - step: Update_applicationGateways_ag1_243
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - add: /properties/urlPathMaps/0
            value:
              name: mypathmap
              properties:
                defaultRedirectConfiguration:
                  id: >-
                    /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/redirectConfigurations/myconfig
                pathRules:
                  - name: myurlrule
                    properties:
                      paths:
                        - /mypath1/*
                      redirectConfiguration:
                        id: >-
                          /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/redirectConfigurations/myconfig
                      provisioningState: Succeeded
                    id: >-
                      /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap/pathRules/myurlrule
                    type: >-
                      Microsoft.Network/applicationGateways/urlPathMaps/pathRules
                provisioningState: Succeeded
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap
              type: Microsoft.Network/applicationGateways/urlPathMaps
          - add: /properties/redirectConfigurations/0/properties/urlPathMaps
            value:
              - id: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap
          - add: /properties/redirectConfigurations/0/properties/pathRules
            value:
              - id: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap/pathRules/myurlrule
      - step: Update_applicationGateways_ag1_245
        resourceName: applicationGateways_ag1
        operationId: ApplicationGateways_CreateOrUpdate
        resourceUpdate:
          - add: /properties/backendAddressPools/1/properties/pathRules
            value:
              - id: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap/pathRules/myurlrule2
          - add: /properties/backendHttpSettingsCollection/1/properties/pathRules
            value:
              - id: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap/pathRules/myurlrule2
          - add: /properties/urlPathMaps/0/properties/pathRules/1
            value:
              name: myurlrule2
              properties:
                paths:
                  - /mypath122/*
                backendAddressPool:
                  id: >-
                    /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/backendAddressPools/mypool
                backendHttpSettings:
                  id: >-
                    /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/backendHttpSettingsCollection/http_settings
                provisioningState: Succeeded
              id: >-
                /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_ag_url_path_map_edge_case000001/providers/Microsoft.Network/applicationGateways/ag1/urlPathMaps/mypathmap/pathRules/myurlrule2
              type: Microsoft.Network/applicationGateways/urlPathMaps/pathRules
    variables:
      publicIpAddressName: pip1
      applicationGatewayName: ag1
