scope: ResourceGroup
testScenarios:
  - description: test_nw_connection_monitor_v2_endpoint
    steps:
      - step: NetworkWatchers_ListAll_1332
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: Create_connectionMonitors_CMv2-01
        resourceName: connectionMonitors_CMv2-01
        exampleFile: ../examples/Create_connectionMonitors_CMv2-01_Generated_1334.json
        operationId: ConnectionMonitors_CreateOrUpdate
      - step: Create_virtualNetworks_cmv2-vnet
        resourceName: virtualNetworks_cmv2-vnet
        exampleFile: ../examples/Create_virtualNetworks_cmv2-vnet_Generated.json
        operationId: VirtualNetworks_CreateOrUpdate
      - step: Subnets_Get_1336
        exampleFile: ../examples/Subnets_Get_2_Generated.json
        operationId: Subnets_Get
      - step: NetworkWatchers_ListAll_1337
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1338
        exampleFile: ../examples/ConnectionMonitors_Get_1338_Generated.json
        operationId: ConnectionMonitors_Get
      - step: Update_connectionMonitors_CMv2-01_1340
        resourceName: connectionMonitors_CMv2-01
        operationId: ConnectionMonitors_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/endpoints
            value:
              - name: vm2
                resourceId: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/connection_monitor_v2_test_6xjg6cv4jg6buvj3j5ru2g4btirttrtw7xv72eivnrdx743e/providers/Microsoft.Compute/virtualMachines/vm2
              - name: bing
                address: bing.com
              - name: cm_subnet_endpoint
                type: AzureSubnet
                resourceId: >-
                  /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/connection_monitor_v2_test_000001/providers/Microsoft.Network/virtualNetworks/cmv2-vnet/subnets/subnet1
                scope:
                  include: []
                  exclude:
                    - address: 10.0.0.25
                coverageLevel: BelowAverage
          - replace: /properties/testConfigurations/0
            value:
              name: DefaultIcmp
              testFrequencySec: 60
              protocol: Icmp
              icmpConfiguration:
                disableTraceRoute: false
          - replace: /properties/testGroups/0/testConfigurations/0
            value: DefaultIcmp
          - replace: /properties/testGroups/0/sources
            value:
              - vm2
              - cm_subnet_endpoint
          - replace: /properties/startTime
            value: '2021-02-24T15:47:20.475507Z'
      - step: NetworkWatchers_ListAll_1341
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1342
        exampleFile: ../examples/ConnectionMonitors_Get_1342_Generated.json
        operationId: ConnectionMonitors_Get
      - step: Update_connectionMonitors_CMv2-01_1344
        resourceName: connectionMonitors_CMv2-01
        operationId: ConnectionMonitors_CreateOrUpdate
        resourceUpdate:
          - add: /properties/endpoints/3
            value:
              name: Github
              type: ExternalAddress
              address: github.com
          - add: /properties/testGroups/0/destinations/1
            value: Github
          - replace: /properties/startTime
            value: '2021-02-24T15:47:33.819249Z'
      - step: NetworkWatchers_ListAll_1345
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1346
        exampleFile: ../examples/ConnectionMonitors_Get_1346_Generated.json
        operationId: ConnectionMonitors_Get
      - step: NetworkWatchers_ListAll_1347
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1348
        exampleFile: ../examples/ConnectionMonitors_Get_1346_Generated.json
        operationId: ConnectionMonitors_Get
      - step: NetworkWatchers_ListAll_1349
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1350
        exampleFile: ../examples/ConnectionMonitors_Get_1346_Generated.json
        operationId: ConnectionMonitors_Get
      - step: Update_connectionMonitors_CMv2-01_1352
        resourceName: connectionMonitors_CMv2-01
        operationId: ConnectionMonitors_CreateOrUpdate
        resourceUpdate:
          - remove: /properties/endpoints/2
          - remove: /properties/testGroups/0/sources/1
          - replace: /properties/startTime
            value: '2021-02-24T15:47:50.3819451Z'
      - step: NetworkWatchers_ListAll_1353
        exampleFile: ../examples/NetworkWatchers_ListAll_1226_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: ConnectionMonitors_Get_1354
        exampleFile: ../examples/ConnectionMonitors_Get_1354_Generated.json
        operationId: ConnectionMonitors_Get
    variables:
      networkWatcherName: NetworkWatcher_eastus
      connectionMonitorName: CMv2-01
      virtualNetworkName: cmv2-vnet
      subnetName: subnet1
