scope: ResourceGroup
testScenarios:
  - description: test_network_vpn_gateway_aad
    steps:
      - step: Create_publicIPAddresses_ip
        resourceName: publicIPAddresses_ip
        exampleFile: ../examples/Create_publicIPAddresses_ip_Generated_1216.json
        operationId: PublicIPAddresses_CreateOrUpdate
      - step: Create_virtualNetworks_vnet
        resourceName: virtualNetworks_vnet
        exampleFile: ../examples/Create_virtualNetworks_vnet_Generated_1218.json
        operationId: VirtualNetworks_CreateOrUpdate
      - step: Create_virtualNetworkGateways_gw
        resourceName: virtualNetworkGateways_gw
        exampleFile: ../examples/Create_virtualNetworkGateways_gw_Generated.json
        operationId: VirtualNetworkGateways_CreateOrUpdate
      - step: Update_virtualNetworkGateways_gw_1221
        resourceName: virtualNetworkGateways_gw
        operationId: VirtualNetworkGateways_CreateOrUpdate
        resourceUpdate:
          - add: /properties/vpnClientConfiguration/vpnAuthenticationTypes/0
            value: AAD
          - add: /properties/vpnClientConfiguration/aadTenant
            value: >-
              https://login.microsoftonline.com/0ab2c4f4-81e6-44cc-a0b2-b3a47a1443f4
          - add: /properties/vpnClientConfiguration/aadAudience
            value: a21fce82-76af-45e6-8583-a08cb3b956f9
          - add: /properties/vpnClientConfiguration/aadIssuer
            value: https://sts.windows.net/0ab2c4f4-81e6-44cc-a0b2-b3a47a1443f4/
      - step: Update_virtualNetworkGateways_gw_1223
        resourceName: virtualNetworkGateways_gw
        operationId: VirtualNetworkGateways_CreateOrUpdate
        resourceUpdate:
          - remove: /properties/vpnClientConfiguration/vpnAuthenticationTypes/0
          - remove: /properties/vpnClientConfiguration/aadTenant
          - remove: /properties/vpnClientConfiguration/aadAudience
          - remove: /properties/vpnClientConfiguration/aadIssuer
    variables:
      publicIpAddressName: ip
      virtualNetworkName: vnet
      virtualNetworkGatewayName: gw
